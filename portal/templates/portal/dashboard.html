{% extends "portal/base.html" %}

{% block content %}
<header class="mb-12">
    <span class="text-campus-blue dark:text-blue-400 font-bold text-sm tracking-widest uppercase">Overview</span>
    <h2 class="text-5xl font-extrabold text-slate-900 dark:text-white mt-2 tracking-tighter">
        Tu Campus. <br>
        <span class="text-slate-400 dark:text-slate-500">Inteligencia y Gestión.</span>
    </h2>
</header>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    <div class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-100 dark:border-slate-800 shadow-sm hover:shadow-xl hover:shadow-blue-500/5 transition-all duration-500 group">
        <div class="w-12 h-12 bg-blue-50 dark:bg-blue-900/30 rounded-2xl flex items-center justify-center text-campus-blue dark:text-blue-400 mb-6 group-hover:scale-110 transition-transform">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
        </div>
        <h3 class="text-slate-500 dark:text-slate-400 font-semibold italic">Materias en curso</h3>
        <p class="text-7xl font-black text-slate-900 dark:text-white tracking-tighter mt-2">{{ materias_count }}</p>
        <div class="mt-6 flex items-center text-campus-mint dark:text-emerald-400 font-bold text-sm gap-2">
            <span>Sincronizado</span>
            <div class="w-2 h-2 bg-campus-mint dark:bg-emerald-400 rounded-full animate-pulse"></div>
        </div>
    </div>

    <div class="md:col-span-2 bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-100 dark:border-slate-800 shadow-sm flex items-center overflow-hidden relative">
        <div class="absolute -right-10 -top-10 w-40 h-40 bg-blue-50 dark:bg-blue-900/10 rounded-full blur-3xl"></div>
        
        <div class="relative z-10">
            <h3 class="text-2xl font-bold text-slate-800 dark:text-slate-100">¿Qué haremos hoy?</h3>
            <p class="text-slate-500 dark:text-slate-400 mt-2 max-w-sm">Gestiona tus alumnos, revisa las notas y organiza el semestre desde un solo lugar con InfoCampus.</p>
            <a href="{% url 'gestion_materias' %}" class="inline-block mt-6 bg-slate-900 dark:bg-campus-blue text-white px-8 py-4 rounded-2xl font-bold hover:bg-campus-blue dark:hover:bg-blue-700 transition-all active:scale-95">
                Empezar a gestionar
            </a>
        </div>
    </div>
</div>

<div class="mt-12 bg-white dark:bg-slate-900 p-10 rounded-[3rem] border border-slate-100 dark:border-slate-800 shadow-sm">
    <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-slate-800 dark:text-slate-100 tracking-tight">Actividad del Sistema</h3>
        <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Últimos 7 días</span>
    </div>
    <div class="h-[300px]">
        <canvas id="activityChart"></canvas>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    function renderChart() {
        const isDark = document.documentElement.classList.contains('dark');
        const ctx = document.getElementById('activityChart').getContext('2d');
        
        // Destruir gráfico anterior si existe para evitar duplicados al cambiar de tema
        if (window.myChart) window.myChart.destroy();

        window.myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom'],
                datasets: [{
                    label: 'Interacciones',
                    data: [12, 19, 15, 25, 22, 30, 45],
                    borderColor: isDark ? '#60A5FA' : '#0052CC',
                    backgroundColor: isDark ? 'rgba(96, 165, 250, 0.1)' : 'rgba(0, 82, 204, 0.05)',
                    fill: true,
                    tension: 0.4,
                    borderWidth: 4,
                    pointRadius: 4,
                    pointBackgroundColor: isDark ? '#60A5FA' : '#0052CC'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { 
                        display: false 
                    },
                    x: { 
                        grid: { display: false },
                        ticks: { color: isDark ? '#94A3B8' : '#64748B' },
                        border: { display: false }
                    }
                }
            }
        });
    }

    // Ejecutar al cargar
    renderChart();

    // Escuchar el cambio de tema para actualizar el gráfico
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.attributeName === 'class') renderChart();
        });
    });
    observer.observe(document.documentElement, { attributes: true });
</script>
{% endblock %}